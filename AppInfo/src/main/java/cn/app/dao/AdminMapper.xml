<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.app.dao.AdminMapper">
	<!-- /**分页 并 模糊查询 APP信息*/public List<AppInfo> getAppInfoLikePageHelper(Map<String, Object> map); -->
	<select id="getAppInfoLikePageHelper" parameterType="map" 
		resultType="AppInfo">
		select 
			softwareName,APKName,softwareSize,
			flatformId,(select flatformName from flatform where id=flatformId) flatformName,
			categoryLevel1,(select categoryName from app_category where id=categoryLevel1) categoryName1,
			categoryLevel2,(select categoryName from app_category where id=categoryLevel2) categoryName2,
			categoryLevel3,(select categoryName from app_category where id=categoryLevel3) categoryName3,
			versionId,v.*,
			status,
			downloads 
		from app_info i , app_version v 
		where i.versionId=v.id 
		<if test="softwareName!=null and softwareName!=''">
			and softwareName like concat('%',#{appInfo.softwareName},'%') 
		</if>
		<if test="categoryLevel1!=null and categoryLevel1!=''">
			and categoryLevel1=#{appInfo.categoryLevel1} 
		</if>
		<if test="categoryLevel2!=null and categoryLevel2!=''">
			and categoryLevel2=#{appInfo.categoryLevel2} 
		</if>
		<if test="categoryLevel3!=null and categoryLevel3!=''">
			and categoryLevel3=#{appInfo.categoryLevel3} 
		</if>
		<if test="status!=null and status!=''">
			and status=#{appInfo.status} 
		</if>
		<if test="softwareName!=null and softwareName!=''">
			and flatformId=#{appInfo.flatformId} 
		</if>
		limit #{ph.startNo},#{ph.pageSize}
	</select>
	
	<!-- /** 根据条件  查询总记录数 */ public Integer getCount(AppInfo appInfo); -->
	<select id="getCount" parameterType="AppInfo" 
		resultType="int">
		select 
			count(1) 
		from app_info 
		<trim prefix="where" prefixOverrides="and">
			<if test="softwareName!=null and softwareName!=''">
				and softwareName like concat('%',#{softwareName},'%') 
			</if>
			<if test="categoryLevel1!=null and categoryLevel1!=''">
				and categoryLevel1=#{categoryLevel1} 
			</if>
			<if test="categoryLevel2!=null and categoryLevel2!=''">
				and categoryLevel2=#{categoryLevel2} 
			</if>
			<if test="categoryLevel3!=null and categoryLevel3!=''">
				and categoryLevel3=#{categoryLevel3} 
			</if>
			<if test="status!=null and status!=''">
				and status=#{status} 
			</if>
			<if test="softwareName!=null and softwareName!=''">
				and flatformId=#{flatformId} 
			</if>
		</trim>
		
	</select>
</mapper>
